@page
@model _2._Sem_Project_Eksamen_System.Pages.Students.GetStudentModel
@{
    ViewData["Title"] = "Student Overview";
}

<div class="page-body">
    <div class="dashboard-container">
        <!-- WELCOME SECTION -->
        <div class="welcome-card">
            <h1>Student Overview</h1>
            <p>View and manage all students in the system</p>
        </div>

        <!-- SEARCH AND FILTER SECTION -->
        <div class="section-card">
            <div class="section-header">
                <h2>Search & Filter</h2>
            </div>
            <div class="search-container">
                <form method="get">
                    <div class="search-form">
                        <div class="form-group">
                            <label for="Filter_FilterByName" class="form-label">Name</label>
                            <input type="text"
                                   asp-for="Filter.FilterByName"
                                   class="form-control compact-input"
                                   placeholder="Name..."
                                   pattern="[A-Za-z\s]+"
                                   title="Only letters and spaces allowed"/>
                        </div>

                        <div class="form-group">
                            <label for="Filter_FilterByEmail" class="form-label">Email</label>
                            <input type="email"
                                   asp-for="Filter.FilterByEmail"
                                   class="form-control compact-input"
                                   placeholder="Email..."
                                   title="Enter a valid email address "/>
                        </div>

                        @*Added positive digit entry restriction*@

                        <div class="form-group">
                            <label for="Filter_FilterById" class="form-label">Student ID</label>
                            <input type="number"
                                   asp-for="Filter.FilterById"
                                   class="form-control compact-input"
                                   placeholder="Positive digits only — e.g., 1, 2, 3"
                                   min="1"
                                   step="1"/>
                                  
                            <span asp-validation-for="Filter.FilterById" class="text-danger"></span>
                            
                        </div>

                        <div class="form-group">
                            <label for="Filter_FilterByClass" class="form-label">Class</label>
                            <select asp-for="Filter.FilterByClass" class="form-control compact-input">
                                <option value="">All Classes</option>
                                @if (Model.AvailableClasses != null)
                                {
                                    foreach (var className in Model.AvailableClasses)
                                    {
                                        <option value="@className">@className</option>
                                    }
                                }
                            </select>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <span class="btn-icon">🔍</span>
                            Search
                        </button>
                        <a asp-page="/Students/GetStudent" class="btn btn-secondary">
                            <span class="btn-icon">🔄</span>
                            Reset
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- TABLE DISPLAY SECTION -->
        <div class="section-card">
            <div class="section-header">
                <h2>All Students</h2>
                <div class="header-actions">
                    @await Html.PartialAsync("_CreateButton", new CreateButtonModel
                    {
                        Page = "/Students/CreateStudent",
                                        Text = "Add New Student"
                                        })
                </div>
            </div>

            <!-- ACTIVE FILTERS DISPLAY -->
            @{
                var activeFilters = new List<string>();
                if (!string.IsNullOrEmpty(Model.Filter.FilterByName))
                    activeFilters.Add($"Name: {Model.Filter.FilterByName}");
                if (!string.IsNullOrEmpty(Model.Filter.FilterByEmail))
                    activeFilters.Add($"Email: {Model.Filter.FilterByEmail}");
                if (!string.IsNullOrEmpty(Model.Filter.FilterByClass))
                    activeFilters.Add($"Class: {Model.Filter.FilterByClass}");
                if (Model.Filter.FilterById.HasValue)
                    activeFilters.Add($"ID: {Model.Filter.FilterById}");
            }

            @if (activeFilters.Any())
            {
                <div class="filter-info">
                    <p>Showing results for: <strong>@string.Join(", ", activeFilters)</strong></p>
                </div>
            }

            <!-- STUDENTS DATA TABLE -->
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <!--  Important Section STUDENT ID COLUMN (HIDDEN VISUALLY) -->
                            <th class="hidden-column">Student ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Class</th>
                            <th class="actions-header">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.Students != null && Model.Students.Any())
                        {
                            foreach (var student in Model.Students)
                            {
                                <tr>
                                    <!-- STUDENT ID CELL (HIDDEN VISUALLY) -->
                                    <td class="hidden-column">@student.StudentId</td>
                                    <td>@student.StudentName</td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(student.Email))
                                        {
                                            @student.Email
                                        }
                                        else
                                        {
                                            <span class="not-assigned">Not Given</span>
                                        }
                                    </td>
                                    <td>
                                        @if (student.StudentsToClasses != null && student.StudentsToClasses.Any())
                                        {
                                            @string.Join(", ", student.StudentsToClasses.Select(sc => sc.Class?.ClassName))
                                        }
                                        else
                                        {
                                            <span class="not-assigned">Not Assigned</span>
                                        }
                                    </td>
                                    <td class="action-buttons">
                                        <!-- Updated to match exam button order and styling -->
                                        <a asp-page="./DetailStudent" asp-route-id="@student.StudentId" class="btn-toggle btn-details">
                                            <span class="btn-icon">📋</span>
                                            Details
                                        </a>
                                        <a asp-page="./EditStudent" asp-route-id="@student.StudentId" class="btn-toggle btn-edit">Edit</a>
                                        <a asp-page="./DeleteStudent" asp-route-id="@student.StudentId" class="btn-toggle btn-delete">Delete</a>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="5" class="no-data">
                                    <div class="empty-state">
                                        <span class="empty-icon">👥</span>
                                        @if (!string.IsNullOrEmpty(Model.Filter.FilterByName) ||
                                                                            !string.IsNullOrEmpty(Model.Filter.FilterByEmail) ||
                                                                            !string.IsNullOrEmpty(Model.Filter.FilterByClass) ||
                                                                            Model.Filter.FilterById.HasValue)
                                        {
                                            <p>No students found matching your search criteria</p>
                                            <a asp-page="/Students/GetStudent" class="btn-toggle" role="menuitem">Show All Students</a>
                                        }
                                        else
                                        {
                                            <p>No students found in the system</p>
                                            <a asp-page="/Students/CreateStudent" class="btn btn-primary btn-add">
                                                <span class="btn-icon">➕</span>
                                                Add First Student
                                            </a>
                                        }
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
    /* ==============================================
           SECTION 1: LAYOUT & CONTAINER STYLES
        ============================================== */
    .search-container {
        padding: 1.5rem;
    }

    .search-form {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 1rem;
        align-items: end;
    }

        .search-form .form-group {
            margin-bottom: 0;
        }

        .search-form .form-label {
            font-weight: 600;
            margin-bottom: 0.25rem;
            display: block;
            font-size: 0.9rem;
        }

    .compact-input {
        height: 36px;
        padding: 0.375rem 0.75rem;
        font-size: 0.875rem;
    }

    /* ==============================================
           SECTION 2: HEADER & FILTER STYLES
        ============================================== */
    .header-actions {
        display: flex;
        gap: 1rem;
    }

    .filter-info {
        background-color: #e8f4fd;
        border: 1px solid #b6d7e8;
        border-radius: 4px;
        padding: 1rem;
        margin: 1rem 1.5rem;
    }

        .filter-info p {
            margin: 0;
            color: #2c5aa0;
        }

    .form-actions {
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 1px solid #eee;
    }

    /* ==============================================
           SECTION 3: HIDDEN COLUMN STYLES
           ⭐⭐ THIS IS THE KEY SOLUTION SECTION ⭐⭐
        ============================================== */
    .hidden-column {
        display: none !important;
        /*
            WHY THIS SOLUTION IS BEST:
            - Uses CSS class for clear intent
            - !important ensures it overrides other styles
            - Works for both header and data cells
            - Zero impact on backend logic
            - Easy to toggle later by removing class
            - Student ID still available for actions (Edit/Delete links)
            */
    }

    /* ==============================================
           SECTION 4: BUTTON & ACTION STYLES
        ============================================== */
    .btn-add {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        background-color: #059669;
        color: white;
        border: 1px solid #059669;
        border-radius: 6px;
        text-decoration: none;
        font-size: 0.875rem;
        font-weight: 600;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(5, 150, 105, 0.3);
    }

        .btn-add:hover {
            background-color: #047857;
            border-color: #047857;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(5, 150, 105, 0.4);
            color: white;
            text-decoration: none;
        }

        .btn-add:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(5, 150, 105, 0.3);
        }

    .btn-icon {
        font-size: 0.875rem;
    }

    .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        text-decoration: none;
        font-size: 0.875rem;
        font-weight: 500;
        border: 1px solid transparent;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-primary {
        background-color: #0066cc;
        color: white;
        border-color: #0066cc;
    }

    .btn-secondary {
        background-color: #6b7280;
        color: white;
        border-color: #6b7280;
    }

    .btn:hover {
        opacity: 0.9;
        transform: translateY(-1px);
    }

    .action-buttons {
        display: flex;
        gap: 0.5rem;
    }

    .btn-toggle {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0.375rem 0.75rem;
        border-radius: 4px;
        text-decoration: none;
        font-size: 0.875rem;
        transition: all 0.2s;
    }

    .btn-edit {
        background-color: #e7f1ff;
        color: #0066cc;
        border: 1px solid #b6d7e8;
    }

    .btn-details {
        background-color: #f0f9ff;
        color: #0c6c8c;
        border: 1px solid #b6d7e8;
    }

    .btn-delete {
        background-color: #fef2f2;
        color: #dc2626;
        border: 1px solid #fecaca;
    }

    .btn-toggle:hover {
        opacity: 0.9;
        transform: translateY(-1px);
    }

    /* ==============================================
           SECTION 5: TABLE & EMPTY STATE STYLES
        ============================================== */
    .no-data {
        text-align: center;
        padding: 2rem;
    }

    .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
    }

    .empty-icon {
        font-size: 3rem;
        opacity: 0.5;
    }

    .not-assigned {
        color: #6b7280;
        font-style: italic;
    }

    /* ==============================================
           SECTION 6: RESPONSIVE DESIGN
        ============================================== */
    @@media (max-width: 768px) {
        .search-form {
            grid-template-columns: 1fr;
        }

        .form-actions {
            flex-direction: column;
        }

        .header-actions {
            justify-content: center;
        }

        .action-buttons {
            flex-direction: column;
        }
    }
</style>