@page "{id:int}"
@model _2._Sem_Project_Eksamen_System.Pages.Eksamner.Edit_ExamModel
@{
    ViewData["Title"] = "Edit Exam";
}

<div class="page-body">
    <div class="dashboard-container">
        <!-- HEADER SECTION -->
        <div class="welcome-card">
            <h1>Edit: @Model.Exam.ExamName</h1>
            <p>Update exam information</p>
        </div>

        <!-- SUCCESS MESSAGE -->
        @if (TempData["SuccessMessage"] is string successMessage)
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <strong>Success!</strong> @successMessage
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }

        <!-- MAIN FORM SECTION -->
        <div class="section-card">
            <div class="section-header">
                <h2>Exam Information</h2>
            </div>

            <div class="form-container">
                <form method="post">
                    <!-- HIDDEN FIELDS -->
                    <input type="hidden" asp-for="Exam.ExamId" />
                    <input type="hidden" asp-for="Exam.ReExamId" />

                    <!-- THREE COLUMN FORM GRID -->
                    <div class="row">

                        <!-- COLUMN 1: BASIC INFORMATION -->
                        <div class="col">
                            <h3 class="form-section-title">Basic Information</h3>

                            <div class="form-group">
                                <label asp-for="Exam.ExamName" class="form-label">Exam Name</label>
                                <input asp-for="Exam.ExamName" class="form-control" placeholder="Enter exam name" />
                                <span asp-validation-for="Exam.ExamName" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="Exam.ClassId" class="form-label">Class</label>
                                <select asp-for="Exam.ClassId" class="form-control" asp-items="Model.ClassList">
                                    <option value="">-- Select Class --</option>
                                </select>
                                <span asp-validation-for="Exam.ClassId" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="Exam.Description" class="form-label">Description</label>
                                <textarea asp-for="Exam.Description" class="form-control" rows="3" placeholder="Enter exam description"></textarea>
                                <span asp-validation-for="Exam.Description" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- COLUMN 2: EXAM DETAILS -->
                        <div class="col">
                            <h3 class="form-section-title">Exam Details</h3>

                            <div class="form-group">
                                <label asp-for="Exam.CensorType" class="form-label">Censor Type</label>
                                <select asp-for="Exam.CensorType" class="form-control">
                                    <option value="">-- Select Censor Type --</option>
                                    <option value="Intern">Intern</option>
                                    <option value="Extern">Extern</option>
                                </select>
                                <span asp-validation-for="Exam.CensorType" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="Exam.Format" class="form-label">Format</label>
                                <input asp-for="Exam.Format" class="form-control" placeholder="e.g., Oral, Written" />
                                <span asp-validation-for="Exam.Format" class="text-danger"></span>
                            </div>

                            <!-- CHECKBOX GROUP -->
                            <div class="checkbox-group">
                                <div class="form-check">
                                    <input asp-for="Exam.ExamPatrol" class="form-check-input" type="checkbox" />
                                    <label asp-for="Exam.ExamPatrol" class="form-check-label">Exam Invigilation</label>
                                </div>

                                <div class="form-check">
                                    <input asp-for="Exam.IsReExam" class="form-check-input" type="checkbox" />
                                    <label asp-for="Exam.IsReExam" class="form-check-label">Is Re-Exam</label>
                                </div>

                                <div class="form-check">
                                    <input asp-for="Exam.IsFinalExam" class="form-check-input" type="checkbox" />
                                    <label asp-for="Exam.IsFinalExam" class="form-check-label">Is Final Exam</label>
                                </div>
                            </div>
                        </div>

                        <!-- COLUMN 3: DATES & ASSIGNMENTS -->
                        <div class="col">
                            <h3 class="form-section-title">Dates & Assignments</h3>

                            <div class="form-group">
                                <label asp-for="Exam.DeliveryDate" class="form-label">Delivery Date</label>
                                <input asp-for="Exam.DeliveryDate" type="date" class="form-control" />
                                <span asp-validation-for="Exam.DeliveryDate" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="Exam.ExamStartDate" class="form-label">Start Date</label>
                                <input asp-for="Exam.ExamStartDate" type="date" class="form-control" />
                                <span asp-validation-for="Exam.ExamStartDate" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="Exam.ExamEndDate" class="form-label">End Date</label>
                                <input asp-for="Exam.ExamEndDate" type="date" class="form-control" />
                                <span asp-validation-for="Exam.ExamEndDate" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="CensorTeacherId" class="form-label">Censor</label>
                                <select asp-for="CensorTeacherId" class="form-control" asp-items="Model.TeacherList">
                                    <option value="">-- Select Censor --</option>
                                </select>
                                <span asp-validation-for="CensorTeacherId" class="text-danger"></span>
                            </div>


                            <!-- Multy Select Examiners-->
                            <div class="divider" style="margin-bottom:1.5rem;">
                                <div class="form-group">
                                    <legend class="form-label">Examiners</legend>
                                    <div style="max-height:100px; overflow-y:auto; border:1px solid #e2e8f0; padding:8px; border-radius:6px;">
                                        @foreach (var i in Model.ExaminerSelect)
                                        {
                                            var item = i;
                                            <div class="form-check ms-4" style="padding:.25rem .5rem;">
                                                <input class="form-check-input"
                                                       type="checkbox"
                                                       name="SelectedTeacherIds"
                                                       value="@item.SelectValue"
                                                       id="examiner_@item.SelectValue"
                                                       @(item.IsSelected ? "checked" : "") />
                                                <label class="form-check-label" for="examiner_@item.SelectValue">@item.SelectText</label>
                                            </div>
                                        }
                                    </div>
                                    <span asp-validation-for="SelectedTeacherIds" class="text-danger"></span>
                                </div>
                            </div>

                            <!-- Multy Select Rooms-->
                            <div class="divider" style="margin-bottom:1.5rem;">
                                <div class="form-group">
                                    <legend class="form-label">Assign Rooms</legend>
                                    <div style="max-height:150px; overflow-y:auto; border:1px solid #e2e8f0; padding:8px; border-radius:6px;">
                                        @foreach (var i in Model.RoomSelect)
                                        {
                                            var item = i;
                                            <div class="form-check ms-4" style="padding:.25rem .5rem;">
                                                <input class="form-check-input"
                                                       type="checkbox"
                                                       name="SelectedRoomIds"
                                                       value="@item.SelectValue"
                                                       id="room_@item.SelectValue"
                                                       @(item.IsSelected ? "checked" : "") />
                                                <label class="form-check-label" for="room_@item.SelectValue">@item.SelectText</label>
                                            </div>
                                        }
                                    </div>
                                    <span asp-validation-for="SelectedRoomIds" class="text-danger"></span>
                                </div>
                            </div>

                            <!-- CONDITIONAL STUDENT COUNT FOR REEXAMS -->
                            @if (Model.Exam.IsReExam)
                            {
                                <div class="form-group">
                                    <label asp-for="Exam.NumOfStud" class="form-label">Number of Students</label>
                                    <input asp-for="Exam.NumOfStud" type="number" class="form-control" />
                                    <span asp-validation-for="Exam.NumOfStud" class="text-danger"></span>
                                </div>
                            }
                        </div> <!-- END OF ROW-->

                    </div> <!-- END OF FORM GRID to Exam -->
                    <!-- REEXAM SECTION -->
                    <div class="reexam-section">
                        <div class="reexam-toggle">
                            <input asp-for="EditReExam" type="checkbox" class="form-check-input" id="editReExamBox" />
                            <label class="form-check-label" for="editReExamBox">
                                @if (Model.HasReExam)
                                {
                                    <span class="reexam-toggle-label">Edit linked ReExam?</span>
                                    <span class="reexam-toggle-description">Edit the re-examination linked to this exam</span>
                                }
                                else
                                {
                                    <span class="reexam-toggle-label">
                                        <i class="bi bi-node-plus"></i>
                                        Create a ReExam?
                                    </span>
                                    <span class="reexam-toggle-description">Create a new re-examination for this exam</span>
                                }
                            </label>
                        </div>

                        <div id="reExamFields" class="reexam-fields" style="display:none;">
                            <div class="reexam-header">
                                <h3>ReExam Details</h3>
                            </div>

                            <div class="form-group" id="reExamPreviewBlock" style="display:none;">
                                <label class="form-label">ReExam Name Preview:</label>
                                <div id="reExamNamePreview" class="reexam-preview"></div>
                            </div>

                            <div class="form-group">
                                <label asp-for="ReExam.ExamName" class="form-label">ReExam Name</label>
                                <input asp-for="ReExam.ExamName" class="form-control" placeholder="ReExam name" />
                                <span asp-validation-for="ReExam.ExamName" class="text-danger"></span>
                            </div>

                            <div class="divider" style="margin-bottom:1.5rem;">
                                <div class="form-group">
                                    <legend class="form-label">ReExam Examiners</legend>
                                    <div style="max-height:100px; overflow-y:auto; border:1px solid #e2e8f0; padding:8px; border-radius:6px;">
                                        @foreach (var i in Model.ReExaminerSelect)
                                        {
                                            var item = i;
                                            <div class="form-check ms-4" style="padding:.25rem .5rem;">
                                                <input class="form-check-input"
                                                       type="checkbox"
                                                       name="SelectedReExamTeacherIds"
                                                       value="@item.SelectValue"
                                                       id="reexaminer_@item.SelectValue"
                                                       @(item.IsSelected ? "checked" : "") />
                                                <label class="form-check-label" for="reexaminer_@item.SelectValue">@item.SelectText</label>
                                            </div>
                                        }
                                    </div>
                                    <span asp-validation-for="SelectedReExamTeacherIds" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="divider" style="margin-bottom:1.5rem;">
                                <div class="form-group">
                                    <legend class="form-label">Assign Rooms (ReExam)</legend>
                                    <div style="max-height:150px; overflow-y:auto; border:1px solid #e2e8f0; padding:8px; border-radius:6px;">
                                        @foreach (var i in Model.ReRoomSelect)
                                        {
                                            var item = i;
                                            <div class="form-check ms-4" style="padding:.25rem .5rem;">
                                                <input class="form-check-input"
                                                       type="checkbox"
                                                       name="SelectedReExamRoomIds"
                                                       value="@item.SelectValue"
                                                       id="reroom_@item.SelectValue"
                                                       @(item.IsSelected ? "checked" : "") />
                                                <label class="form-check-label" for="reroom_@item.SelectValue">@item.SelectText</label>
                                            </div>
                                        }
                                    </div>
                                    <span asp-validation-for="SelectedReExamRoomIds" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-4">
                                <label asp-for="ReExam.NumOfStud" class="form-label">Number of Students</label>
                                <input asp-for="ReExam.NumOfStud" type="number" class="form-control" />
                                <span asp-validation-for="ReExam.NumOfStud" class="text-danger"></span>
                            </div>

                            <div class="form-grid compact-grid">
                                <div class="form-group">
                                    <label asp-for="ReExam.ExamStartDate" class="form-label">ReExam Start Date</label>
                                    <input asp-for="ReExam.ExamStartDate" type="date" class="form-control" />
                                    <span asp-validation-for="ReExam.ExamStartDate" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <label asp-for="ReExam.ExamEndDate" class="form-label">ReExam End Date</label>
                                    <input asp-for="ReExam.ExamEndDate" type="date" class="form-control" />
                                    <span asp-validation-for="ReExam.ExamEndDate" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <label asp-for="ReExam.DeliveryDate" class="form-label">ReExam Delivery Date</label>
                                    <input asp-for="ReExam.DeliveryDate" type="date" class="form-control" />
                                    <span asp-validation-for="ReExam.DeliveryDate" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- FORM ACTIONS -->
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <span class="btn-icon">💾</span>
                            Save Changes
                        </button>
                        <a asp-page="/Eksamner/GetEksamner" class="btn btn-secondary">
                            <span class="btn-icon">←</span>
                            Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- STYLES SECTION - RESTORED ORIGINAL HEADER STYLING -->
<style>
    /* LAYOUT STYLES */
    .page-body {
        padding: 2rem;
    }

    .dashboard-container {
        max-width: 1200px;
        margin: 0 auto;
    }

    /* CARD STYLES - RESTORED ORIGINAL WHITE WITH YELLOW BORDER */
    .welcome-card {
        background: white;
        border-left: 4px solid #FFC107;
        color: #333;
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 2rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

        .welcome-card h1 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 600;
        }

        .welcome-card p {
            margin: 0.5rem 0 0 0;
            color: #666;
        }

    .section-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }

    .section-header {
        background: #f8f9fa;
        padding: 1.25rem;
        border-bottom: 1px solid #dee2e6;
    }

        .section-header h2 {
            margin: 0;
            color: #495057;
            font-size: 1.4rem;
        }

    /* FORM STYLES */
    .form-container {
        padding: 2rem;
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .compact-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
    }

    .form-column {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    /* FORM ELEMENTS */
    .form-section-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: #2d3748;
        margin: 0 0 1rem 0;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid #e2e8f0;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .form-label {
        font-weight: 600;
        color: #4a5568;
        font-size: 0.95rem;
    }

    .form-control {
        padding: 0.75rem;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s ease;
    }

        .form-control:focus {
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
            outline: none;
        }

    textarea.form-control {
        min-height: 100px;
        resize: vertical;
    }

    /* CHECKBOX STYLES */
    .checkbox-group {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .form-check {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .form-check-input {
        width: 1.2em;
        height: 1.2em;
        margin: 0;
        border: 2px solid #cbd5e0;
    }

    .form-check-label {
        font-weight: 500;
        color: #4a5568;
    }

    /* REEXAM STYLES */
    .reexam-section {
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 2px solid #e2e8f0;
    }

    .reexam-toggle {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 1.5rem;
        background: #f0f9ff;
        border: 2px solid #bee3f8;
        border-radius: 12px;
        margin-bottom: 1.5rem;
    }

    .reexam-toggle-label {
        font-weight: 700;
        color: #2b6cb0;
        font-size: 1.1rem;
    }

    .reexam-toggle-description {
        display: block;
        font-size: 0.95rem;
        color: #718096;
        margin-top: 0.5rem;
    }

    .reexam-fields {
        background: #f7fafc;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        padding: 2rem;
    }

    .reexam-header {
        margin-bottom: 1.5rem;
    }

        .reexam-header h3 {
            margin: 0;
            color: #2d3748;
            font-size: 1.3rem;
        }

    .reexam-preview {
        padding: 1rem;
        background: white;
        border: 2px dashed #cbd5e0;
        border-radius: 8px;
        font-weight: 600;
        color: #38a169;
    }

    /* MULTI-SELECT STYLES */
    .multi-select {
        min-height: 120px;
        padding: 0.5rem;
    }

    /* BUTTON STYLES */
    .form-actions {
        display: flex;
        gap: 1rem;
        justify-content: flex-start;
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 2px solid #e2e8f0;
    }

    .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.875rem 1.5rem;
        border-radius: 8px;
        text-decoration: none;
        font-size: 1rem;
        font-weight: 600;
        border: 2px solid transparent;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-primary {
        background: #4299e1;
        color: white;
        border-color: #4299e1;
    }

    .btn-secondary {
        background: #718096;
        color: white;
        border-color: #718096;
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .btn-icon {
        font-size: 1.1rem;
    }

    /* VALIDATION STYLES */
    .text-danger {
        font-size: 0.875rem;
        color: #e53e3e;
        margin-top: 0.25rem;
    }

    .alert {
        margin-bottom: 2rem;
    }

    /* RESPONSIVE DESIGN */
    @@media (max-width: 768px) {
        .page-body {
            padding: 1rem;
        }

        .form-grid {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .compact-grid {
            grid-template-columns: 1fr;
        }

        .form-actions {
            flex-direction: column;
        }

        .reexam-toggle {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .welcome-card {
            padding: 1.5rem;
        }

        .form-container {
            padding: 1.5rem;
        }
    }
</style>


@section Scripts {
    <script>
        // Wait until the entire HTML document has been fully loaded before running the script
        document.addEventListener('DOMContentLoaded', function () {

            //  Get references to the key elements
            const checkbox = document.getElementById('editReExamBox');         // Checkbox to enable/disable ReExam section
            const reExamFields = document.getElementById('reExamFields');     // Container holding ReExam input fields
            const examNameInput = document.getElementById('Exam_ExamName');   // Input field for the main exam name
            const reExamPreview = document.getElementById('reExamNamePreview'); // Element to display the ReExam name preview

            //  Exit early if any of the required elements are missing
            if (!checkbox || !reExamFields || !examNameInput || !reExamPreview) return;

            //  Function to update the UI based on checkbox state and exam name input from user
            const updateUI = () => {
                const isChecked = checkbox.checked; // Check if the ReExam checkbox is selected

                // Show or hide the ReExam fields based on checkbox state
                reExamFields.style.display = isChecked ? 'block' : 'none';

                // Update the preview text to show "ReEksamen-{ExamName}" if checkbox is checked
                reExamPreview.textContent = isChecked ? `ReEksamen-${examNameInput.value || ''}` : '';
            };

            //  Attach event listeners to update the UI when user interacts
            checkbox.addEventListener('change', updateUI);       // When checkbox is toggled
            examNameInput.addEventListener('input', updateUI);   // When exam name is typed or changed

            updateUI(); //  Run once on page load to initialize the correct state
        });
    </script>
}